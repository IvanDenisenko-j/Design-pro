{% extends 'base.html' %}

{% block content %}
<h2>{% if user.is_staff %}Все заявки{% else %}Мои заявки{% endif %}</h2>

{% if applications %}
    {% for application in applications %}
    <div style="border: 1px solid #ccc; padding: 15px; margin: 10px 0;">
        <h3>{{ application.name }}</h3>
        <p><strong>Категория:</strong> {{ application.category }}</p>
        <p><strong>Статус:</strong> {{ application.get_status_display }}</p>
        <p><strong>Описание:</strong> {{ application.description }}</p>
        <p><strong>Дата создания:</strong> {{ application.created_at|date:"d.m.Y H:i" }}</p>

        {% if application.image %}
        <p><strong>Изображение:</strong> <img src="{{ application.image.url }}" alt="{{ application.name }}" width="200"></p>
        {% endif %}

        <div>
            {% if application.can_change_status %}
            <a href="{% url 'change_status' application.pk %}">Изменить статус</a>
            {% endif %}

            {% if user == application.user or user.is_superuser %}
            <form method="post" action="{% url 'delete_application' application.pk %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" onclick="return confirm('Удалить эту заявку?')">Удалить</button>
            </form>
            {% endif %}
        </div>
    </div>
    {% endfor %}
{% else %}
    <p>Заявок нет.</p>
{% endif %}

{% if not user.is_staff %}
<a href="{% url 'create_application' %}">+ Создать новую заявку</a>
<br>
{% endif %}

<a href="{% url 'home' %}">← Назад в кабинет</a>
{% endblock %}